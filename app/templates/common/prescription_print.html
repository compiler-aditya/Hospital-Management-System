<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prescription - {{ appointment.patient.full_name }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Plus+Jakarta+Sans:wght@600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .prescription-container {
            max-width: 210mm;
            margin: 40px auto;
            background: white;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            min-height: 297mm; /* A4 Height */
            position: relative;
        }
        .rx-header {
            background: #4f46e5;
            color: white;
            padding: 40px;
            border-radius: 4px 4px 0 0;
        }
        .rx-body {
            padding: 60px 40px;
        }
        .rx-footer {
            padding: 40px;
            border-top: 2px solid #e5e7eb;
            margin-top: auto;
        }
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 120px;
            color: rgba(79, 70, 229, 0.03);
            font-weight: 800;
            pointer-events: none;
            z-index: 0;
        }
        .info-label {
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            color: #6b7280;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .info-value {
            font-weight: 500;
            font-size: 1rem;
            color: #111827;
        }
        .rx-symbol {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-size: 48px;
            color: #4f46e5;
            margin-bottom: 20px;
            display: block;
        }
        .btn-print {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            padding: 12px 24px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        @media print {
            body {
                background-color: white;
                -webkit-print-color-adjust: exact;
            }
            .prescription-container {
                margin: 0;
                box-shadow: none;
                width: 100%;
                max-width: 100%;
            }
            .btn-print, .no-print {
                display: none !important;
            }
            .rx-header {
                background-color: #4f46e5 !important; /* Try to force print color */
                color: white !important;
            }
        }
    </style>
</head>
<body>

    <button onclick="window.print()" class="btn btn-primary rounded-pill btn-print d-flex align-items-center gap-2">
        <i class="bi bi-printer-fill"></i> Print Prescription
    </button>

    <div class="prescription-container">
        <!-- Watermark -->
        <div class="watermark">Rx</div>

        <!-- Header -->
        <div class="rx-header">
            <div class="row align-items-center">
                <div class="col-6">
                    <h2 class="mb-1 fw-bold" style="font-family: 'Plus Jakarta Sans', sans-serif;">HealthCare Plus</h2>
                    <p class="mb-0 opacity-75 small">Excellence in Medical Care</p>
                </div>
                <div class="col-6 text-end">
                    <div class="info-label text-white text-opacity-75">Prescription ID</div>
                    <div class="info-value text-white">#RX-{{ appointment.id }}-{{ appointment.created_at.strftime('%Y%m%d') }}</div>
                </div>
            </div>
        </div>

        <div class="rx-body">
            <!-- Doctor & Patient Info -->
            <div class="row mb-5">
                <div class="col-6">
                    <h5 class="text-primary fw-bold mb-3">Doctor Details</h5>
                    <div class="mb-3">
                        <div class="fw-bold text-dark fs-5">{{ appointment.doctor.full_name }}</div>
                        <div class="text-muted">{{ appointment.doctor.specialization }}</div>
                        <div class="text-muted small">{{ appointment.doctor.qualification }}</div>
                        <div class="text-muted small mt-1">Reg No: HCP-DOC-{{ appointment.doctor.id }}</div>
                    </div>
                </div>
                <div class="col-6">
                    <h5 class="text-primary fw-bold mb-3">Patient Details</h5>
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="fw-bold text-dark fs-5">{{ appointment.patient.full_name }}</div>
                        </div>
                        <div class="col-6">
                            <div class="info-label">Age / Gender</div>
                            <div class="info-value">
                                {% if appointment.patient.date_of_birth %}
                                    {{ ((today - appointment.patient.date_of_birth).days // 365) }} Yrs
                                {% else %}
                                    N/A
                                {% endif %} 
                                / {{ appointment.patient.gender }}
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="info-label">Date</div>
                            <div class="info-value">{{ appointment.appointment_date.strftime('%d %B, %Y') }}</div>
                        </div>
                        <div class="col-12">
                            <div class="info-label">Address</div>
                            <div class="info-value small">{{ appointment.patient.address or 'N/A' }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <hr class="my-5 border-2">

            <!-- Diagnosis -->
            <div class="mb-5">
                <h5 class="text-uppercase text-secondary fw-bold mb-3" style="letter-spacing: 0.1em; font-size: 0.85rem;">Diagnosis</h5>
                <p class="lead">{{ appointment.treatment.diagnosis }}</p>
            </div>

            <!-- Prescription -->
            <div class="mb-5">
                <div class="rx-symbol">Rx</div>
                <div class="p-4 bg-light rounded-3 border" style="white-space: pre-wrap; font-family: 'Courier New', serif; font-size: 1.1rem; line-height: 1.8;">{{ appointment.treatment.prescription }}</div>
            </div>

            <!-- Notes -->
            {% if appointment.treatment.notes %}
            <div class="mb-5">
                <h5 class="text-uppercase text-secondary fw-bold mb-3" style="letter-spacing: 0.1em; font-size: 0.85rem;">Advice / Notes</h5>
                <p>{{ appointment.treatment.notes }}</p>
            </div>
            {% endif %}
        </div>

        <!-- Footer -->
        <div class="rx-footer">
            <div class="row align-items-end">
                <div class="col-8">
                    <p class="small text-muted mb-1">This prescription is valid for 30 days from the date of issue.</p>
                    <p class="small text-muted mb-0">Generated electronically by HealthCare Plus HMS.</p>
                </div>
                <div class="col-4 text-center">
                    <div class="mb-2" style="font-family: 'Signature', cursive; font-size: 1.5rem; color: #4f46e5;">
                        Dr. {{ appointment.doctor.full_name.split()[-1] }}
                    </div>
                    <div class="border-top border-dark pt-2">
                        <div class="info-label">Doctor's Signature</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
